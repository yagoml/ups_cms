var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;define(["jquery","underscore","backbone","text!src/templates/components/autoCrud/dados.html",ENV+"/js/components/autoCrud/tableDados",ENV+"/js/components/autoCrud/windowNewDado",ENV+"/js/components/autoCrud/windowEditDado",ENV+"/js/components/autoCrud/filtroDados",ENV+"/js/components/loader","text!src/templates/components/autoCrud/windowNewDadoTpl.html","text!src/templates/components/autoCrud/windowEditDadoTpl.html","text!"+ENV+"/css/components/autoCrud.css"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n;return m=baseUrl+"dados",n=new i({class:"pLoader"}),function(i){function j(){return j.__super__.constructor.apply(this,arguments)}return extend(j,i),j.prototype.template=b.template(d),j.prototype.qtdDados=20,j.prototype.events={"click #editarDado":"openWindowEditDado","click #novoDado":"openWindowNewDado","click #filtrarDados":"openWindowFiltroDados","click #removerFiltro":"removerFiltro"},j.prototype.initialize=function(){return this.model=new c.Model,this.collection=new c.Collection,this.collection.model=this.model,this.collection.url=baseUrl+"dados/tabela",this.reloadEvents(),this.collection.fetch({data:{pagina:0},success:function(a){return function(){return a.showQtdDados(),a.checaNecessidadeBotoes(),a.renderTable(),a.delegateEvents()}}(this)})},j.prototype.delegateEvents=function(){return j.__super__.delegateEvents.apply(this,arguments),this.listenTo(this.tableDados,"eventoDeletado",this.deletarDado.bind(this)),this.listenTo(this.tableDados,"eventosSolicitados",this.buscarDados.bind(this))},j.prototype.undelegateEvents=function(){return j.__super__.undelegateEvents.apply(this,arguments),this.stopListening(this.tableDados,"eventoDeletado"),this.stopListening(this.tableDados,"eventosSolicitados")},j.prototype.render=function(){return a("#panelContent").html(n.show()),a.when(loadCssInline(l)).then(function(a){return function(){return a.$el.html(a.template),a.buttons=a.$("#buttonsArea").html(),a.$("#buttonsArea").html(n.show())}}(this)),this},j.prototype.checaNecessidadeBotoes=function(){return 0===this.collection.models.length?this.$("#buttonsArea").remove():this.$("#buttonsArea").html(this.buttons)},j.prototype.reloadEvents=function(){return this.undelegateEvents(),this.delegateEvents()},j.prototype.openWindowEditDado=function(a){return this.model=this.collection.findWhere({id_evento:this.$(a.target).attr("id-evento")}),this.windowEditDado=new g({model:this.model.attributes}),this.stopListening(this.windowEditDado),this.listenTo(this.windowEditDado,"eventoEditado",this.editDado.bind(this)),this.$("#eventosTable").append(this.windowEditDado.render())},j.prototype.openWindowNewDado=function(a){return this.windowNewDado=new f({model:this.model}),this.stopListening(this.windowNewDado),this.listenTo(this.windowNewDado,"eventoAdicionado",this.addDado.bind(this)),this.$("#eventosTableContent").append(this.windowNewDado.render())},j.prototype.openWindowFiltroDados=function(){return this.windowFiltroDados=new h({model:this.model}),this.stopListening(this.windowFiltroDados),this.listenTo(this.windowFiltroDados,"eventoFiltrado",this.filtrarDados.bind(this)),this.$("#eventosTableContent").append(this.windowFiltroDados.render())},j.prototype.addDado=function(a){var b;return this.endTableLoader("show"),b=(new Dado).set(a).attributes,this.collection.create(b,{wait:!0,success:function(a){return function(b){return a.tableDados.addLinha(b),a.endTableLoader("hide")}}(this)})},j.prototype.editDado=function(a){var b;return this.tableDados.loaderLinha(a.id_evento),b=(new Dado).set(a).attributes,this.model.save(b,{wait:!0,success:function(a){return function(){return a.tableDados.editLinha(b)}}(this)})},j.prototype.filtrarDados=function(c){return a.ajax({url:baseUrl+"dados/filtro",type:"POST",dataType:"json",data:c,success:function(a){return function(d){return a.collection=new Dados,b.each(d,function(b){return a.collection.models.push((new Dado).set(b))}),a.renderTable(),a.renderfiltroAplicado(c)}}(this)})},j.prototype.deletarDado=function(b){return a.ajax({type:"POST",data:{id:b},url:m}),this.model=this.collection.at(this.collection.findIndex({id_evento:b})),this.model.destroy()},j.prototype.renderTable=function(){return this.$("#eventosTableContent").html(n.show()),this.tableDados=new e(this.collection.models),this.$("#eventosTableContent").html(this.tableDados.render().$el)},j.prototype.endTableLoader=function(a){return this.tableDados.endTableLoader(a)},j.prototype.tableLoader=function(a){switch(a){case"show":return this.$("#eventosTableContent").html(n.show())}},j.prototype.renderfiltroAplicado=function(a){var c;return c=[],this.$("#titleFiltro").css("display","block"),a.id_evento.length>0&&c.push("ID Dado: <span class='pad5 alert-info'>"+a.id_evento+"</span>"),a.tipo.length>0&&c.push("Tipo cont√©m: <span class='pad5 alert-info'>"+a.tipo+"</span>"),b.each(c,function(a){return function(b){return a.$("#filtroInfos").append("<li>"+b+"</li>")}}(this))},j.prototype.removerFiltro=function(){return this.$("#eventosTableContent").html(n.show()),this.initialize(),this.$("#titleFiltro").css("display","none"),this.$("#filtroInfos").html("")},j.prototype.showQtdDados=function(){return this.$("#qtdDados").html(this.collection.models.length)},j.prototype.buscarDados=function(c){return a.ajax({type:"GET",dataType:"json",url:baseUrl+"dados",data:c,success:function(a){return function(c){return 0!==c.length?b.each(c,function(b,d){var e;if(e=new Dado,e.set("id_evento",b.id_evento),e.set("tipo",b.tipo),a.collection.models.push(e),a.tableDados.addLinha(e.attributes),d===c.length-1)return a.tableDados.paginationControls.requisicaoAtiva=!1,a.qtdDados+=c.length,a.$("#qtdDados").html(a.qtdDados)}):(a.tableDados.paginationControls.limiteBuscaAtingido=!0,!1)}}(this)})},j}(c.View)});