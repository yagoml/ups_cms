var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;define(["jquery","underscore","backbone",ENV+"/js/router",ENV+"/js/components/windowPopup",ENV+"/js/components/loader","text!src/templates/components/autoCrud/EditDataTpl.html","text!src/templates/components/upload/upload.html","lib/ckeditor/ckeditor"],function(a,b,c,d,e,f,g,h){var i;return i=7.058252427184466,function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return extend(d,c),d.prototype.className="auto-crud-edit-data",d.prototype.template=b.template(g),d.prototype.events={"submit #editDataForm":"prepareToSave"},d.prototype.initialize=function(a){var c;return this.options=a,c=this.options,this.model=c.model,this.table=c.table,this.tableInfos=c.tableInfos,this.tableFks=c.tableFks,this.tableTitles=c.tableTitles,this.systemFields=c.systemFields,this.inputTypes=c.inputTypes,this.fks=c.fks,this.refTables=c.refTables,this.fk=c.fk,this.filterID=c.filterID,this.configSite=c.configSite,this.options.pk=b.findWhere(this.tableInfos,{primary_key:1}).name,this.pk=this.options.pk},d.prototype.render=function(){return this.$el.html(this.template(this.options)),this},d.prototype.afterRender=function(){var c,d,e;return c=this.getCharsPerLine(),d="",e=!1,b.any(this.refTables)?this.$("#relatedData").html(this.createRefLinks()):this.$("#relatedData").parent().hide(),b.each(this.tableInfos,function(a){return function(f){var g,h,i,j,k;if(i=(null!=(k=b.findWhere(a.tableTitles,{campo:f.name}))?k.nome:void 0)||capitalize(f.name.replace(/(?![a-zA-Z0-9])./g," ")),j=a.systemFields.includes(f.name),!f.primary_key&&!b.findWhere(a.fks,{COLUMN_NAME:f.name}))return h=a.model.get(f.name),g=null!=h?h.length:void 0,d+="<div class='form-box-edit' style=' "+("text"===f.type||"varchar"===f.type?"width: 100%;":"width: fit-content; margin-right: 15px;")+" "+(j?"display: none;":void 0)+" '><label>"+i+"</label>","text"!==f.type&&"varchar"!==f.type?d+="<input type='"+a.inputTypes[f.type]+"' id='"+f.name+"' name='"+f.name+"' class='form-control' value='"+(null!=h?h:"")+"'>":a.isFileDirectory(h)?(e=!0,d+='<div class="fn-upload"></div>'):d+="<textarea class='form-control' id='"+f.name+"' name='"+f.name+"' rows='"+(null!=g?Math.ceil(g/c):1)+"'>"+(null!=h?h:"")+"</textarea>",d+="</div>"}}(this)),this.$(".form-body").html(d),e&&this.filesUpload(),b.each(this.$("textarea"),function(c){return function(d){var e;if(e=a(d).attr("name"),"varchar"!==b.findWhere(c.tableInfos,{name:e}).type&&!c.configSite)return CKEDITOR.replace(e)}}(this))},d.prototype.prepareToSave=function(a){var b;return a.stopPropagation(),a.preventDefault(),b=this.getFormData(),this.save(b)},d.prototype.save=function(c){var d;return d=this.model.get(this.pk),a.ajax({type:"post",dataType:"json",url:baseUrl+"dados/saveData",data:{data:c,table:this.table,pk:this.pk,id:null!=d?d:void 0,fk:null!=this.fk?this.fk:void 0,filterID:null!=this.filterID?this.filterID:void 0},beforeSend:function(a){return function(){return a.disableBtn()}}(this),success:function(a){return function(d){if(a.enableBtn(),b.isEmpty(a.model.attributes)?a.model.set(d):a.model.set(c),!a.configSite)return a.trigger("backFromEdit",a.model)}}(this)})},d.prototype.getFormData=function(){var a;return a={},b.each(this.tableInfos,function(c){return function(d){var e;if(null!=(e=c.$("#"+d.name).val())&&b.any(e))return a[d.name]=e}}(this)),a},d.prototype.disableBtn=function(){return this.$("#saveData").attr("disabled",!0),this.$("#saveData").prepend(new f({class:"pLoader"}).show())},d.prototype.enableBtn=function(){return this.$("#saveData").attr("disabled",!1),this.$("#saveData").find(".loader-wrapper").remove()},d.prototype.getCharsPerLine=function(){return this.$(".auto-crud-form-edit").width()/i},d.prototype.isFileDirectory=function(a){var b;return b=new RegExp("uploads/","ig"),b.test(a)},d.prototype.createRefLinks=function(){var a;return a="",b.each(this.refTables,function(b){return function(c){return a+="<a href='#admin/autoCrud/"+b.table+"/related/"+c.TABLE_NAME+"/"+c.COLUMN_NAME+"/"+b.model.get(b.pk)+"' class='col-xs-12 margB10'> "+capitalize(c.TABLE_NAME.replace(/(?![a-zA-Z0-9])./g," "))+" </a>"}}(this)),a},d.prototype.filesUpload=function(){var a,b;return this.$(".fn-upload").html(h),a=this.getFieldDirectory(this.model),b=this.model.get(this.pk),this.$("#fine-uploader-manual-trigger").fineUploader({autoUpload:!1,multiple:!1,template:"qq-template-manual-trigger",session:{endpoint:baseUrl+"dados/singleFile?table="+this.table+"&pk="+this.pk+"&filterID="+b+(null!=a?"&fieldDir="+a:"")},deleteFile:{enabled:!0,endpoint:baseUrl+"dados/deleteFile",method:"POST",params:{table:"uploaded_single_files",fieldDir:null!=a?a:void 0,singleFile:!0,parentTable:this.table,parentPK:this.pk,id:b}},request:{endpoint:baseUrl+"dados/upload",params:{fk:"id_registro",id:b,table:"uploaded_single_files",singleFile:!0,parentTable:this.table,parentPK:this.pk,fieldDir:a}},thumbnails:{placeholders:{waitingPath:baseUrl+"/lib/fine-uploader/placeholders/waiting-generic.png",notAvailablePath:baseUrl+"/lib/fine-uploader/placeholders/not_available-generic.png"}},callbacks:{onError:function(a,b,c,d){return alert(JSON.parse(d.response).error)}}}),this.$("#trigger-upload").click(function(a){return function(){return a.$("#fine-uploader-manual-trigger").fineUploader("uploadStoredFiles")}}(this))},d.prototype.getFieldDirectory=function(a){var c;return c="",b.map(a.attributes,function(a){return function(b,d){if(a.isFileDirectory(b))return c=d}}(this)),c},d}(c.View)});