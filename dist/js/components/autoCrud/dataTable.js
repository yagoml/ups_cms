var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;define(["jquery","underscore","backbone",ENV+"/js/components/loader"],function(a,b,c,d){var e,f;return e="<div class='alert'>Sem dados cadastrados.</div>",f=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return extend(d,c),d.prototype.tagName="tr",d.prototype.template=b.template('<td><input type="checkbox" class="dado-selector"></td>\n<% _.each(keys, (key) => { %>\n\t<td title=\'<%= dado.get(key) %>\'>\n\t\t<div class=\'dado-wrapper\'>\n\t\t\t<% if(regexFileDir.test(dado.get(key))) { %>\n\t\t\t\t<a href=\'<%= baseUrl + dado.get(key) %>\' target=\'blank\'><%= dado.get(key).replace(\'uploads/\', \'\') %></a>\n\t\t\t<% } else { %>\n\t\t\t\t<%= dado.get(key).replace(/<[^>]*>/ig, "") %>\n\t\t\t<% } %>\n\t\t</div>\n\t</td>\n<% }); %>\n<td>\n\t<div class=\'dado-wrapper dado-ordem\'>\n\t\t<%= dado.get(\'ordem\') %>\n\t</div>\n</td>\n<td>\n\t<div style="width: 70px; margin-top: 3.5px;">\n\t\t<i title="Expandir item" class="glyphicon glyphicon-chevron-down"></i>\n\t\t<i title="Aumentar prioridade" class="glyphicon glyphicon-arrow-up"></i>\n\t\t<i title="Diminuir prioridade" class="glyphicon glyphicon-arrow-down"></i>\n\t\t<i title="Excluir item" class="glyphicon glyphicon-trash remove-data"></i>\n\t</div>\n</td>'),d.prototype.events={"change .dado-selector":"toggleCheckItem",click:"openEditDado","click .remove-data":"removeData","click .glyphicon-arrow-up":"addOrder","click .glyphicon-arrow-down":"subOrder","click .glyphicon-chevron-down":"expandLine","click .glyphicon-chevron-up":"retractLine"},d.prototype.initialize=function(a,b,c){this.model=a,this.keys=b,this.pk=c},d.prototype.render=function(){return this.$el.html(this.template({dado:this.model,keys:this.keys,regexFileDir:new RegExp("uploads/","ig")})),this},d.prototype.openEditDado=function(b){if(!a(b.target).is("input.dado-selector")&&"I"!==a(b.target)[0].nodeName&&!a(b.target).is(".dado-wrapper a"))return this.trigger("openEditData",this.model)},d.prototype.toggleCheckItem=function(b){return this.model.set("checked",a(b.target).prop("checked")),this.trigger("itemChecked",this.model)},d.prototype.removeData=function(){if(window.confirm("Deseja realmente excluir o registro #"+this.model.get(this.pk)+"?"))return this.trigger("removeData",this.model),this.remove()},d.prototype.addOrder=function(a){return this.model.set("ordem",parseInt(this.model.get("ordem"))+1),this.$(".dado-ordem").html(this.model.get("ordem")),this.$el.attr("ordem",this.model.get("ordem")),this.trigger("addOrder",{model:this.model,e:a,view:this})},d.prototype.subOrder=function(a){return this.model.set("ordem",parseInt(this.model.get("ordem"))-1),this.$(".dado-ordem").html(this.model.get("ordem")),this.$el.attr("ordem",this.model.get("ordem")),this.trigger("subOrder",{model:this.model,e:a,view:this})},d.prototype.expandLine=function(){return b.each(this.$(".dado-wrapper"),function(b){return function(c){var d,e;return d=a(c),e=b.$(".glyphicon-chevron-down"),d.css({"white-space":"normal"}),e.addClass("glyphicon-chevron-up"),e.removeClass("glyphicon-chevron-down")}}(this))},d.prototype.retractLine=function(){return b.each(this.$(".dado-wrapper"),function(b){return function(c){var d,e;return d=a(c),e=b.$(".glyphicon-chevron-up"),d.css({"white-space":"nowrap"}),e.addClass("glyphicon-chevron-down"),e.removeClass("glyphicon-chevron-up")}}(this))},d}(c.View),function(c){function g(){return g.__super__.constructor.apply(this,arguments)}return extend(g,c),g.prototype.className="table-responsive",g.prototype.linhas=[],g.prototype.events={"change #dadosSelectAll":"selectAll"},g.prototype.initialize=function(a){var b;return this.options=a,b=this.options,this.dados=b.dados,this.systemFields=b.systemFields,this.tableTitles=b.tableTitles,this.pk=b.pk,this.fk=b.fk,this.fks=b.fks,this.selectAllState=!1},g.prototype.render=function(){var a;return this.dados.models.length?(this.keys=[],a='<table class="table table-bordered table-striped table-hover dadosTable"><thead><tr><th><input type="checkbox" id="dadosSelectAll"></th>',b.each(b.keys(b.first(this.dados.models).attributes),function(c){return function(d){var e,f,g,h;if(g=c.systemFields.includes(d),f=b.findWhere(c.fks,{COLUMN_NAME:d}),g||f||(c.keys.push(d),e=capitalize(d).replace(/(?![a-zA-Z0-9])./g," "),a+="<th>"+(null!=c.tableTitles?(null!=(h=b.findWhere(c.tableTitles,{campo:d}))?h.nome:void 0)||e:e)),d===c.pk)return c.keys.push(d),a+="<th>ID</th>"}}(this)),a+='<th title="Prioridade">Prio.</th>',a+="<th>Ações</th></tr></thead><tbody></tbody></table>",this.$el.first("tr").append(a),b.each(this.dados.models,function(a){return function(b){return a.addLinha(b)}}(this))):this.$el.html(e),this},g.prototype.addLinhaTpl=function(a){var b;return this.linhas.push(b=new f(a,this.keys,this.pk)),this.listenTo(b,"openEditData",function(a){return function(b){return a.$el.prepend(new d({class:"mLoader"}).show()),a.trigger("openEditData",b)}}(this)),this.listenTo(b,"itemChecked",function(a){return function(b){return a.trigger("itemChecked",[b])}}(this)),this.listenTo(b,"removeData",function(a){return function(b){return a.trigger("removeData",[b])}}(this)),this.listenTo(b,"addOrder",function(a){return function(b){return a.trigger("addOrder",b.model),a.upLine(b)}}(this)),this.listenTo(b,"subOrder",function(a){return function(b){return a.trigger("subOrder",b.model),a.downLine(b)}}(this)),b.render().$el},g.prototype.editLinhaTpl=function(a,b){return this.listenTo(b,"openEditData",function(a){return function(b){return a.$el.prepend(new d({class:"mLoader"}).show()),a.trigger("openEditData",b)}}(this)),this.listenTo(b,"itemChecked",function(a){return function(b){return a.trigger("itemChecked",b)}}(this)),this.listenTo(b,"removeData",function(a){return function(b){return a.trigger("removeData",[b])}}(this)),b.render().$el},g.prototype.updateLinha=function(c){var d,e,g,h;return d=b.findIndex(this.linhas,{model:c}),h=this.linhas[d].$el[0].rowIndex-1,g=new f(c,this.keys,this.pk),e=this.editLinhaTpl(c,g),a(this.$("tbody")[0].children[h]).replaceWith(e),this.linhas[d].remove(),this.linhas[d]=g,this.ellipsisTableData()},g.prototype.addLinha=function(a){return this.$("tbody").append(this.addLinhaTpl(a))},g.prototype.delegateEvents=function(){if(g.__super__.delegateEvents.apply(this,arguments),b.any(this.linhas))return b.each(this.linhas,function(a){return function(a){return a.delegateEvents()}}())},g.prototype.undelegateEvents=function(){if(g.__super__.undelegateEvents.apply(this,arguments),b.any(this.linhas))return b.each(this.linhas,function(a){return function(a){return a.undelegateEvents()}}())},g.prototype.editLinha=function(a){return this.linhas[a.id_dado].$el.children("td").eq(1).html(a.tipo)},g.prototype.loaderLinha=function(a){return this.linhas[a].$el.children("td").eq(1).html(new d({class:"pLoader"}).show())},g.prototype.endTableLoader=function(a){switch(a){case"show":return this.$el.append("<tr class='dataTableLoader'><td colspan='3'>"+new d({class:"pLoader"}).show()+"</td></tr>");case"hide":return this.$(".dataTableLoader").remove()}},g.prototype.checkEmptyTable=function(){if(!this.dados.models.length)return this.$el.html(e)},g.prototype.ellipsisTableData=function(){return b.each(this.$(".dado-wrapper"),function(b){return function(b){return b=a(b),b.css({"white-space":"nowrap",width:b.width()+"px"})}}())},g.prototype.removeLines=function(a){return b.each(a,function(a){return function(c){var d;return d=b.findIndex(a.linhas,{model:c}),a.linhas[d].remove(),a.linhas.splice(d,1)}}(this))},g.prototype.upLine=function(c){var d,e,f;if(f=a(c.e.target),d=f.closest("tr"),e=d.prev("tr"),parseInt(e.attr("ordem"))<parseInt(d.attr("ordem")))return c.view.remove(),e.before(c.view.render().$el),c.view.delegateEvents(),b.each(c.view.$(".dado-wrapper"),function(b){return function(b){return b=a(b),b.css({"white-space":"nowrap",width:b.width()+"px"})}}())},g.prototype.downLine=function(c){var d,e,f;if(f=a(c.e.target),d=f.closest("tr"),e=d.next("tr"),parseInt(e.attr("ordem"))>parseInt(d.attr("ordem")))return c.view.remove(),e.after(c.view.render().$el),c.view.delegateEvents(),b.each(c.view.$(".dado-wrapper"),function(b){return function(b){return b=a(b),b.css({"white-space":"nowrap",width:b.width()+"px"})}}())},g.prototype.selectAll=function(){var c,d;return this.selectAllState=!this.selectAllState,c=this.$(".dado-selector"),b.each(c,function(b){return function(c){var d;return d=a(c),d[0].checked=b.selectAllState}}(this)),d=[],b.each(this.linhas,function(a){return function(b){return b.model.set("checked",a.selectAllState),d.push(b.model)}}(this)),this.trigger("itemChecked",d)},g}(c.View)});