var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;define(["jquery","underscore","backbone","text!src/templates/admin/eventos/eventos.html",ENV+"/js/admin/eventos/eventosModel",ENV+"/js/admin/eventos/eventosCollection",ENV+"/js/admin/eventos/tableEventos",ENV+"/js/admin/eventos/windowNewEvento",ENV+"/js/admin/eventos/windowEditEvento",ENV+"/js/admin/eventos/filtroEventos",ENV+"/js/components/loader","text!src/templates/admin/eventos/windowNewEventoTpl.html","text!src/templates/admin/eventos/windowEditEventoTpl.html","text!dist/css/admin/eventos.css"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o,p;return o=baseUrl+"eventos",p=new k({class:"pLoader"}),function(c){function k(){return k.__super__.constructor.apply(this,arguments)}return extend(k,c),k.prototype.template=b.template(d),k.prototype.qtdEventos=20,k.prototype.events={"click #editarEvento":"openWindowEditEvento","click #novoEvento":"openWindowNewEvento","click #filtrarEventos":"openWindowFiltroEventos","click #removerFiltro":"removerFiltro"},k.prototype.initialize=function(){return this.model=new e,this.collection=new f,this.reloadEvents(),this.collection.fetch({data:{pagina:0},success:function(a){return function(){return a.showQtdEventos(),a.checaNecessidadeBotoes(),a.renderTable(),a.delegateEvents()}}(this)})},k.prototype.delegateEvents=function(){return k.__super__.delegateEvents.apply(this,arguments),this.listenTo(this.tableEventos,"eventoDeletado",this.deletarEvento.bind(this)),this.listenTo(this.tableEventos,"eventosSolicitados",this.buscarEventos.bind(this))},k.prototype.undelegateEvents=function(){return k.__super__.undelegateEvents.apply(this,arguments),this.stopListening(this.tableEventos,"eventoDeletado"),this.stopListening(this.tableEventos,"eventosSolicitados")},k.prototype.render=function(){return a("#panelContent").html(p.show()),a.when(loadCssInline(n)).then(function(a){return function(){return a.$el.html(a.template),a.buttons=a.$("#buttonsArea").html(),a.$("#buttonsArea").html(p.show())}}(this)),this},k.prototype.checaNecessidadeBotoes=function(){return 0===this.collection.models.length?this.$("#buttonsArea").remove():this.$("#buttonsArea").html(this.buttons)},k.prototype.reloadEvents=function(){return this.undelegateEvents(),this.delegateEvents()},k.prototype.openWindowEditEvento=function(a){return this.model=this.collection.findWhere({id_evento:this.$(a.target).attr("id-evento")}),this.windowEditEvento=new i({model:this.model.attributes}),this.stopListening(this.windowEditEvento),this.listenTo(this.windowEditEvento,"eventoEditado",this.editEvento.bind(this)),this.$("#eventosTable").append(this.windowEditEvento.render())},k.prototype.openWindowNewEvento=function(a){return this.windowNewEvento=new h({model:this.model}),this.stopListening(this.windowNewEvento),this.listenTo(this.windowNewEvento,"eventoAdicionado",this.addEvento.bind(this)),this.$("#eventosTableContent").append(this.windowNewEvento.render())},k.prototype.openWindowFiltroEventos=function(){return this.windowFiltroEventos=new j({model:this.model}),this.stopListening(this.windowFiltroEventos),this.listenTo(this.windowFiltroEventos,"eventoFiltrado",this.filtrarEventos.bind(this)),this.$("#eventosTableContent").append(this.windowFiltroEventos.render())},k.prototype.addEvento=function(a){var b;return this.endTableLoader("show"),b=(new e).set(a).attributes,this.collection.create(b,{wait:!0,success:function(a){return function(b){return a.tableEventos.addLinha(b),a.endTableLoader("hide")}}(this)})},k.prototype.editEvento=function(a){var b;return this.tableEventos.loaderLinha(a.id_evento),b=(new e).set(a).attributes,this.model.save(b,{wait:!0,success:function(a){return function(){return a.tableEventos.editLinha(b)}}(this)})},k.prototype.filtrarEventos=function(c){return a.ajax({url:baseUrl+"eventos/filtro",type:"POST",dataType:"json",data:c,success:function(a){return function(d){return a.collection=new f,b.each(d,function(b){return a.collection.models.push((new e).set(b))}),a.renderTable(),a.renderfiltroAplicado(c)}}(this)})},k.prototype.deletarEvento=function(b){return a.ajax({type:"POST",data:{id:b},url:o}),this.model=this.collection.at(this.collection.findIndex({id_evento:b})),this.model.destroy()},k.prototype.renderTable=function(){return this.$("#eventosTableContent").html(p.show()),this.tableEventos=new g(this.collection.models),this.$("#eventosTableContent").html(this.tableEventos.render().$el)},k.prototype.endTableLoader=function(a){return this.tableEventos.endTableLoader(a)},k.prototype.tableLoader=function(a){switch(a){case"show":return this.$("#eventosTableContent").html(p.show())}},k.prototype.renderfiltroAplicado=function(a){var c;return c=[],this.$("#titleFiltro").css("display","block"),a.id_evento.length>0&&c.push("ID Evento: <span class='pad5 alert-info'>"+a.id_evento+"</span>"),a.tipo.length>0&&c.push("Tipo cont√©m: <span class='pad5 alert-info'>"+a.tipo+"</span>"),b.each(c,function(a){return function(b){return a.$("#filtroInfos").append("<li>"+b+"</li>")}}(this))},k.prototype.removerFiltro=function(){return this.$("#eventosTableContent").html(p.show()),this.initialize(),this.$("#titleFiltro").css("display","none"),this.$("#filtroInfos").html("")},k.prototype.showQtdEventos=function(){return this.$("#qtdEventos").html(this.collection.models.length)},k.prototype.buscarEventos=function(c){return a.ajax({type:"GET",dataType:"json",url:baseUrl+"eventos",data:c,success:function(a){return function(c){return 0!==c.length?b.each(c,function(b,d){var f;if(f=new e,f.set("id_evento",b.id_evento),f.set("tipo",b.tipo),a.collection.models.push(f),a.tableEventos.addLinha(f.attributes),d===c.length-1)return a.tableEventos.paginationControls.requisicaoAtiva=!1,a.qtdEventos+=c.length,a.$("#qtdEventos").html(a.qtdEventos)}):(a.tableEventos.paginationControls.limiteBuscaAtingido=!0,!1)}}(this)})},k}(c.View)});